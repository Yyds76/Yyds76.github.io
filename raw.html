<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raw File Access</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', monospace;
            background: #fff;
            color: #000;
        }
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        .error {
            text-align: center;
            padding: 50px;
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">Ê≠£Âú®Âä†ËΩΩ...</div>
    
    <script>
        // ÈÖçÁΩÆ‰ø°ÊÅØ
        const CONFIG = {
            githubUser: 'Yyds76',
            githubRepo: 'Yyds76.github.io'
        };

        // Ê£ÄÊü•ÊòØÂê¶‰∏∫Roblox Executor
        function isRobloxExecutor() {
            const userAgent = navigator.userAgent.toLowerCase();
            const robloxKeywords = ['roblox', 'executor', 'synapse', 'krnl', 'oxygen', 'sentinel'];
            return robloxKeywords.some(keyword => userAgent.includes(keyword)) || 
                   window.location.search.includes('executor=true');
        }

        // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
        function checkAuth() {
            if (isRobloxExecutor()) {
                return true;
            }
            return sessionStorage.getItem('authenticated') === 'true';
        }

        // Ëé∑ÂèñRawÊñá‰ª∂ÂÜÖÂÆπ
        async function getRawFile() {
            const urlParams = new URLSearchParams(window.location.search);
            const scriptId = urlParams.get('id');
            
            if (!scriptId) {
                showError('‚ùå Áº∫Â∞ëËÑöÊú¨IDÂèÇÊï∞');
                return;
            }

            // Ê£ÄÊü•ËÆøÈóÆÊùÉÈôê
            if (!checkAuth()) {
                showError('üîí ËÆøÈóÆË¢´ÊãíÁªù - ÈúÄË¶ÅÁôªÂΩïÊéàÊùÉ');
                return;
            }

            try {
                // ‰ªéGitHub APIËé∑ÂèñÊñá‰ª∂ÂàóË°®
                const response = await fetch(`https://api.github.com/repos/${CONFIG.githubUser}/${CONFIG.githubRepo}/contents`);
                const files = await response.json();
                const luaFiles = files.filter(file => file.type === 'file' && file.name.endsWith('.lua'));
                
                const scriptIndex = parseInt(scriptId.replace('script', '')) - 1;
                
                if (scriptIndex >= 0 && scriptIndex < luaFiles.length) {
                    const file = luaFiles[scriptIndex];
                    const fileResponse = await fetch(file.download_url);
                    const content = await fileResponse.text();
                    
                    // Ê∏ÖÁ©∫È°µÈù¢Âπ∂Âè™ÊòæÁ§∫Á∫ØÊñáÊú¨ÂÜÖÂÆπ
                    document.body.innerHTML = '';
                    document.body.appendChild(document.createTextNode(content));
                    
                    // ËÆæÁΩÆÊ≠£Á°ÆÁöÑContent-Type
                    if (document.contentType) {
                        document.contentType = 'text/plain';
                    }
                } else {
                    showError('‚ùå Êñá‰ª∂Êú™ÊâæÂà∞');
                }
            } catch (error) {
                showError('‚ùå Âä†ËΩΩÊñá‰ª∂Â§±Ë¥•: ' + error.message);
            }
        }

        function showError(message) {
            document.body.innerHTML = `<div class="error">${message}</div>`;
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÊâßË°å
        window.addEventListener('load', getRawFile);
    </script>
</body>
</html>
