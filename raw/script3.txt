-- ğŸš€ HB Hub Script 3
-- è¿™æ˜¯ç¬¬ä¸‰ä¸ªç¤ºä¾‹è„šæœ¬ - é€è§†åŠŸèƒ½

print("ğŸ® HB Hub Script 3 - é€è§†åŠŸèƒ½å·²åŠ è½½!")

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local espEnabled = false
local espBoxes = {}

-- åˆ›å»ºESPæ¡†
function createESP(targetPlayer)
    if targetPlayer == player then return end
    
    local character = targetPlayer.Character
    if not character then return end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    -- åˆ›å»ºBillboardGui
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Name = "ESP_" .. targetPlayer.Name
    billboardGui.Adornee = humanoidRootPart
    billboardGui.Size = UDim2.new(4, 0, 6, 0)
    billboardGui.StudsOffset = Vector3.new(0, 0, 0)
    billboardGui.AlwaysOnTop = true
    billboardGui.Parent = game.CoreGui
    
    -- åˆ›å»ºæ¡†æ¶
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundTransparency = 1
    frame.BorderSizePixel = 2
    frame.BorderColor3 = Color3.fromRGB(255, 0, 0)
    frame.Parent = billboardGui
    
    -- åˆ›å»ºç©å®¶åç§°æ ‡ç­¾
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, 0, 0, 20)
    nameLabel.Position = UDim2.new(0, 0, -0.1, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = targetPlayer.Name
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextScaled = true
    nameLabel.Font = Enum.Font.SourceSansBold
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    nameLabel.Parent = frame
    
    -- åˆ›å»ºè·ç¦»æ ‡ç­¾
    local distanceLabel = Instance.new("TextLabel")
    distanceLabel.Size = UDim2.new(1, 0, 0, 20)
    distanceLabel.Position = UDim2.new(0, 0, 1.1, 0)
    distanceLabel.BackgroundTransparency = 1
    distanceLabel.Text = "0m"
    distanceLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
    distanceLabel.TextScaled = true
    distanceLabel.Font = Enum.Font.SourceSans
    distanceLabel.TextStrokeTransparency = 0
    distanceLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    distanceLabel.Parent = frame
    
    espBoxes[targetPlayer] = {
        gui = billboardGui,
        distanceLabel = distanceLabel
    }
end

-- ç§»é™¤ESP
function removeESP(targetPlayer)
    if espBoxes[targetPlayer] then
        espBoxes[targetPlayer].gui:Destroy()
        espBoxes[targetPlayer] = nil
    end
end

-- æ›´æ–°è·ç¦»
function updateDistance()
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
    
    local playerPosition = player.Character.HumanoidRootPart.Position
    
    for targetPlayer, espData in pairs(espBoxes) do
        if targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local targetPosition = targetPlayer.Character.HumanoidRootPart.Position
            local distance = math.floor((playerPosition - targetPosition).Magnitude)
            espData.distanceLabel.Text = distance .. "m"
        end
    end
end

-- å¯ç”¨ESP
function enableESP()
    espEnabled = true
    
    -- ä¸ºç°æœ‰ç©å®¶åˆ›å»ºESP
    for _, targetPlayer in pairs(Players:GetPlayers()) do
        if targetPlayer.Character then
            createESP(targetPlayer)
        end
    end
    
    print("ğŸ‘ï¸ é€è§†åŠŸèƒ½å·²å¯ç”¨")
end

-- ç¦ç”¨ESP
function disableESP()
    espEnabled = false
    
    -- ç§»é™¤æ‰€æœ‰ESP
    for targetPlayer, _ in pairs(espBoxes) do
        removeESP(targetPlayer)
    end
    
    print("ğŸš« é€è§†åŠŸèƒ½å·²ç¦ç”¨")
end

-- ç©å®¶åŠ å…¥æ—¶åˆ›å»ºESP
Players.PlayerAdded:Connect(function(targetPlayer)
    if espEnabled then
        targetPlayer.CharacterAdded:Connect(function()
            wait(1) -- ç­‰å¾…è§’è‰²å®Œå…¨åŠ è½½
            createESP(targetPlayer)
        end)
    end
end)

-- ç©å®¶ç¦»å¼€æ—¶ç§»é™¤ESP
Players.PlayerRemoving:Connect(function(targetPlayer)
    removeESP(targetPlayer)
end)

-- æŒ‰é”®æ§åˆ¶ (æŒ‰ E é”®åˆ‡æ¢ESP)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.E then
        if espEnabled then
            disableESP()
        else
            enableESP()
        end
    end
end)

-- æ›´æ–°è·ç¦»æ˜¾ç¤º
RunService.Heartbeat:Connect(function()
    if espEnabled then
        updateDistance()
    end
end)

print("ğŸ¯ é€è§†è„šæœ¬åŠ è½½å®Œæˆ! æŒ‰ E é”®åˆ‡æ¢é€è§†åŠŸèƒ½")
